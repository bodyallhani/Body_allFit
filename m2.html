<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>바디올핏 비대면 문진</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans KR", sans-serif;
      background-color: #f1f3f4;
      color: #202124;
      line-height: 1.5;
    }

    .container {
      max-width: 900px;
      margin: 24px auto 40px;
      padding: 0 12px;
    }

    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.3);
      padding: 24px 24px 28px;
      margin-bottom: 16px;
    }

    .card-header {
      border-top: 8px solid #4285f4;
      margin: -24px -24px 24px;
      padding: 16px 24px 8px;
      border-radius: 8px 8px 0 0;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0 0 6px;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #5f6368;
    }

    .highlight-box {
      background: #fce8e6;
      border-left: 4px solid #d93025;
      padding: 12px 14px;
      margin: 12px 0;
      font-size: 0.95rem;
    }

    .section-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin: 24px 0 12px;
    }

    .image-wrapper {
      text-align: center;
      margin: 12px 0;
    }

    .image-wrapper img {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
    }

    /* 상단 두 이미지 폭 맞추기 */
    .hero-img {
      width: 260px;
      max-width: 80%;
      height: auto;
      object-fit: cover;
    }

    .field {
      margin: 24px 0 32px;
    }

    /* 11번 이후 문항 간격 확대 */
    .field-large {
      margin: 40px 0 54px;
    }

    .field-label {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .field-label .required-mark {
      color: #d93025;
      margin-left: 4px;
      font-weight: 700;
    }

    .field-desc {
      font-size: 0.85rem;
      color: #5f6368;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #dadce0;
      font-size: 0.95rem;
    }

    input[type="text"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 1px rgba(66, 133, 244, 0.2);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .inline-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .inline-row .inline-field {
      flex: 1 1 0;
      min-width: 90px;
    }

    .unit-label {
      margin-left: 4px;
      font-size: 0.9rem;
      color: #5f6368;
    }

    .options {
      font-size: 0.95rem;
    }

    .options label {
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .options-inline label {
      display: inline-flex;
      align-items: center;
      margin-right: 12px;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .small-note {
      font-size: 0.8rem;
      color: #5f6368;
      margin-top: 4px;
    }

    .button-row {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border: none;
      border-radius: 4px;
      padding: 10px 18px;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .primary-btn {
      background: #1a73e8;
      color: #fff;
    }

    .secondary-btn {
      background: #e8eaed;
      color: #202124;
    }

    .summary-textarea {
      width: 100%;
      min-height: 220px;
      font-size: 0.9rem;
      white-space: pre-wrap;
    }

    /* 카드번호 관련 (카드 섹션 삭제했지만 다른 곳 영향 없도록 유지) */
    .cardnum-row {
      align-items: center;
      flex-wrap: nowrap;
      gap: 4px;
    }

    .cardnum-row .inline-field {
      flex: 0 0 48px;
      width: 48px;
      min-width: 48px;
    }

    .cardnum-row .inline-field input {
      width: 100%;
      padding: 4px;
      text-align: center;
      font-size: 0.9rem;
      box-sizing: border-box;
    }

    .card-hyphen {
      flex: 0 0 auto;
      padding: 0 1px;
      font-size: 1rem;
      color: #5f6368;
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 16px 22px;
      }
      .card-header {
        margin: -18px -16px 18px;
        padding: 12px 16px 6px;
      }
    }

  </style>
</head>
<body>
  <div class="container">
    <!-- 소개 카드 -->
    <div class="card">
      <div class="card-header">
        <h1>바디올핏 비대면 문진</h1>
        <div class="subtitle">
          바디올한의원 · 바디올핏 다이어트 비대면 상담 전용 문진표
        </div>
      </div>

      <p>
        바디올핏은 가격거품을 빼고,<br />
        오로지 <strong>#치료효과</strong> 만을 목표로 만들어진<br />
        <strong>#간편하고 #쉬운 #다이어트 프로그램</strong>입니다.
      </p>

      <div class="highlight-box">
        <strong>※ 아래 내용과, 설문지를 꼼꼼히 읽고 답변해주세요!!</strong>
      </div>

      <p><strong>[병원 방문없이 집에서 전화로 간편하게]</strong></p>
      <p>
        ※ 비대면의 경우, 진행과정은 아래와 같습니다.<br />
        <strong>[설문작성 → 카카오톡 연락 → 전화상담 → 결제확인 → 택배발송]</strong>
      </p>
      <ul>
        <li>확인 후 순서대로 원장이 전화 상담을 진행합니다.</li>
        <li>전화상담 후 1~3일 내에 택배로 처방을 받으실 수 있습니다.</li>
        <li>
          예약이 밀려 상담전화와 처방이 다소 늦어질 수 있습니다.
          최대한 빠르게 약을 받으실 수 있도록 최선을 다하겠습니다.
        </li>
      </ul>

      <!-- 빨간 박스 내용 교체 -->
      <div class="highlight-box">
        <strong>질문에 굵은 글씨와 함께 빨간
          <span style="color:#d93025">*</span> 표시는 필수 응답 부탁드립니다.</strong>
      </div>

      <!-- 이미지 두 개 (같은 폭) -->
      <div class="image-wrapper">
        <img src="img1.jpg" alt="바디올핏 제품 이미지" class="hero-img" />
      </div>
      <div class="image-wrapper">
        <img src="img2.png" alt="바디올한의원 원장 프로필" class="hero-img" />
      </div>
    </div>

    <!-- 설문 카드 -->
    <form class="card" id="dietForm">
      <div class="section-title">기본 정보</div>

      <!-- 1 -->
      <div class="field">
        <div class="field-label">
          1. 바디올한의원을 내원하신 적이 있나요?
        </div>
        <div class="options">
          <label>
            <input type="radio" name="visit_experience" value="네" />
            네
          </label>
          <label>
            <input type="radio" name="visit_experience" value="아니오" />
            아니오
          </label>
          <label>
            <input type="radio" name="visit_experience" value="기억이 안나요" />
            기억이 안나요
          </label>
        </div>
      </div>

      <!-- 2 실명 (이전: 성함) -->
      <div class="field">
        <div class="field-label">
          2. 실명 <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          실명이 아닌 경우, 처방이 불가합니다. 주민등록상 성함을 정확히 적어주세요.
        </div>
        <input
          type="text"
          id="name"
          name="name"
          required
          autocomplete="name"
          placeholder="예: 홍길동 (실명)"
        />
      </div>

      <!-- 3 성별 -->
      <div class="field">
        <div class="field-label">
          3. 성별 <span class="required-mark">*</span>
        </div>
        <select id="gender" name="gender" required>
          <option value="">선택해주세요</option>
          <option value="남성">남</option>
          <option value="여성">여</option>
          <option value="정할 수 없음">정할 수 없음</option>
        </select>
      </div>

      <!-- 4 나이 -->
      <div class="field">
        <div class="field-label">
          4. 나이 <span class="required-mark">*</span>
        </div>
        <input
          type="text"
          id="age"
          name="age"
          inputmode="numeric"
          pattern="\d*"
          required
          placeholder="숫자만 입력해주세요 (예: 25)"
        />
      </div>

      <!-- 5 키 / 몸무게 -->
      <div class="field">
        <div class="field-label">
          5. 키 / 몸무게 <span class="required-mark">*</span>
        </div>
        <div class="inline-row">
          <div class="inline-field">
            <input
              type="text"
              id="height"
              name="height"
              inputmode="numeric"
              pattern="\d*"
              required
              placeholder="예: 165"
            />
            <span class="unit-label">cm</span>
          </div>
          <div class="inline-field">
            <input
              type="text"
              id="weight"
              name="weight"
              inputmode="numeric"
              pattern="\d*"
              required
              placeholder="예: 62"
            />
            <span class="unit-label">kg</span>
          </div>
        </div>
      </div>

      <!-- 6 연락처 -->
      <div class="field">
        <div class="field-label">
          6. 연락처 <span class="required-mark">*</span>
        </div>
        <input
          type="tel"
          id="phone"
          name="phone"
          inputmode="numeric"
          pattern="\d*"
          required
          placeholder="숫자만 입력해주세요 (예: 01012345678)"
        />
      </div>

      <!-- 7 주민번호 (뒷자리 마스킹 및 유효성 검사) -->
      <div class="field">
        <div class="field-label">
          7. 주민등록번호 <span class="required-mark">*</span>
        </div>
        <div class="inline-row">
          <div class="inline-field">
            <input
              type="text"
              id="rrn1"
              name="rrn1"
              maxlength="6"
              inputmode="numeric"
              pattern="\d*"
              required
              placeholder="앞 6자리"
            />
          </div>
          <div class="inline-field">
            <!-- 표시용 -->
            <input
              type="text"
              id="rrn2_display"
              maxlength="7"
              inputmode="numeric"
              pattern="\d*"
              required
              placeholder="뒤 7자리"
            />
            <!-- 실제 값 (Apps Script/시트로 전송되는 값) -->
            <input
              type="hidden"
              id="rrn2"
              name="rrn2"
            />
          </div>
        </div>
        <div class="small-note">
          뒷자리는 입력 시 첫 번째 숫자만 보이고, 나머지는 자동으로 * 처리됩니다.<br />
          해당 정보는 차트작성 및 연말정산 소득공제에만 사용됩니다.
        </div>
      </div>

      <!-- 8 (기존 9) 현재 질환 -->
      <div class="field">
        <div class="field-label">
          8. 현재 앓고 계신 질환을 전부 써주세요.
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          예시) 뇌혈관질환, 고혈압, 당뇨, 간질환, 심장질환, 신장질환, 우울증,
          천식, 갑상선질환 등
        </div>
        <textarea id="diseases" name="diseases" required></textarea>
      </div>

      <!-- 9 (기존 10) 현재 복용 약 / 건강보조식품 -->
      <div class="field">
        <div class="field-label">
          9. 현재 드시고 계신 약물 혹은 건강보조식품을 가급적 전부 써주세요.
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          다이어트 처방 불가 예시) 암페타민류, 독세---- , --프라민, 노르트-----,
          클로니딘류, 코데인류, 테오필린류, 신지로이드류, 아스피린 정기복용 등
        </div>
        <textarea id="medications" name="medications" required></textarea>
      </div>

      <!-- 10 (기존 11) 임신 관련 -->
      <div class="field field-large">
        <div class="field-label">
          10. 임신 관련 사항 여부를 알려주세요. (복수선택 가능)
          <span class="required-mark">*</span>
        </div>
        <div class="options">
          <label>
            <input
              type="checkbox"
              name="pregnancy"
              value="임신 준비중"
            />임신준비중
          </label>
          <label>
            <input type="checkbox" name="pregnancy" value="임신 중" />임신중
          </label>
          <label>
            <input
              type="checkbox"
              name="pregnancy"
              value="출산 후 5주 이내"
            />출산후 5주 이내
          </label>
          <label>
            <input
              type="checkbox"
              name="pregnancy"
              value="수유 중 혹은 예정"
            />수유중 혹은 예정
          </label>
          <label>
            <input
              type="checkbox"
              name="pregnancy"
              value="관련사항 없음"
            />관련사항 없음
          </label>
          <label>
            <input
              type="checkbox"
              name="pregnancy"
              value="그 외 관련사항"
            />그 외 관련사항
          </label>
        </div>
        <input
          type="text"
          id="pregnancy_other"
          name="pregnancy_other"
          placeholder="‘그 외 관련사항’ 선택 시 자세히 적어주세요."
        />
      </div>

      <!-- 11 (기존 12) 다이어트 한약/양약 경험 -->
      <div class="field field-large">
        <div class="field-label">
          11. 다이어트 한약이나 양약을 기존에 드신 경험이 있으신가요?
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          복용약 종류와 복용 기간을 알려주세요.<br />
          아래 ‘기타’ 부분에는 중복 체크해서<br />
          ① 해당 다이어트를 지금으로부터 몇 개월 혹은 몇 년 전에
          시작하셨는지,<br />
          ② 가르시니아 같은 건강기능식품을 현재 드시고 계신다면
          알려주세요.
        </div>
        <div class="options">
          <label>
            <input
              type="checkbox"
              name="diet_exp"
              value="복용경험 없음"
            />복용 경험 없음
          </label>
          <label>
            <input
              type="checkbox"
              name="diet_exp"
              value="다이어트한약 1달 정도 복용"
            />다이어트한약 1달 정도 복용
          </label>
          <label>
            <input
              type="checkbox"
              name="diet_exp"
              value="다이어트한약 3달 정도 복용"
            />다이어트한약 3달 정도 복용
          </label>
          <label>
            <input
              type="checkbox"
              name="diet_exp"
              value="다이어트한약 6달 이상 복용"
            />다이어트한약 6달 혹은 그 이상 복용
          </label>
          <label>
            <input
              type="checkbox"
              name="diet_exp"
              value="다이어트양약 복용"
            />다이어트양약 복용
          </label>
          <label>
            <input type="checkbox" name="diet_exp" value="기타" />기타
          </label>
        </div>
        <textarea
          id="diet_exp_other"
          name="diet_exp_other"
          placeholder="예시) 양약을 1개월 전에 시작했다가 중단했어요. 다이어트한약을 1년 전에 마지막으로 먹었었어요. 가르시니아를 현재 복용 중입니다."
        ></textarea>
      </div>

      <!-- 12 (신규) 가장 걱정되는 점 -->
      <div class="field field-large">
        <div class="field-label">
          12. 현재 몸 상태나 체중과 관련해서 <strong>가장 걱정되는 점</strong>을 알려주세요.
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          상담·처방 방향을 잡는 데 가장 중요한 항목입니다.
        </div>
        <textarea
          id="main_concern"
          name="main_concern"
          required
          placeholder="예) 살이 빠져도 금방 다시 찔까봐 걱정됩니다.&#10;예) 허리 통증 때문에 운동을 못 하는데 체중이 더 늘까 걱정됩니다."
        ></textarea>
      </div>

      <div class="section-title">현재 몸상태 · 배송 · 프로그램 선택</div>

      <!-- 13 (기존 13) 현재 몸상태 -->
      <div class="field field-large">
        <div class="field-label">
          13. 현재 몸상태에 대해 알려주세요. (중복체크 가능)
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          ‘기타’ 부분에 혹시 알려주실 특이한 증상이 있다면 적어주세요.
        </div>
        <div class="options">
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="잠자기 힘들고, 잘 깹니다."
            />잠자기 힘들고, 잘 깹니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="속쓰림, 소화불량이 있습니다."
            />속쓰림, 소화불량이 있습니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="오심, 구토가 자주 있습니다."
            />오심, 구토가 자주 있습니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="술을 자주 마십니다. (주 4회 이상)"
            />술을 자주 마십니다. (주 4회 이상)
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="가슴 두근거림이나 가슴 답답함이 있습니다."
            />가슴 두근거림이나 가슴 답답함이 있습니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="변비가 심합니다."
            />변비가 심합니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="커피를 마시면 잠을 못 잡니다."
            />커피를 마시면 잠을 못 잡습니다.
          </label>
          <label>
            <input
              type="checkbox"
              name="body_status"
              value="평소에 기운이 없습니다."
            />평소에 기운이 없습니다.
          </label>
          <label>
            <input type="checkbox" name="body_status" value="기타" />기타
          </label>
        </div>
        <textarea
          id="body_status_other"
          name="body_status_other"
          placeholder="기타 증상이나 특이사항이 있다면 적어주세요."
        ></textarea>
      </div>

      <!-- 14 (기존 14) 배송 정보 -->
      <div class="field field-large">
        <div class="field-label">
          14. 택배 받으실 ① 성함 ② 주소 ③ 전화번호를 적어주세요.
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          정확한 배송을 위해 기록 후 다시 한 번 확인 부탁드립니다.
          (예시) 김바디 / 수원시 팔달구 인계동 1114-7, 3층 바디올한의원 / 01080675825(전화번호는 숫자만 기입)
        </div>
        <div class="inline-row">
          <div class="inline-field">
            <input
              type="text"
              id="ship_name"
              name="ship_name"
              required
              placeholder="수령인 성함"
            />
          </div>
          <div class="inline-field">
            <input
              type="tel"
              id="ship_phone"
              name="ship_phone"
              inputmode="numeric"
              pattern="\d*"
              required
              placeholder="수령인 연락처"
            />
          </div>
        </div>
        <textarea
          id="ship_address"
          name="ship_address"
          required
          placeholder="배송 받으실 주소를 정확히 적어주세요."
        ></textarea>
      </div>

      <!-- 이벤트 가격 이미지 -->
      <div class="image-wrapper">
        <img src="img3.jpg" alt="바디올핏 이벤트 가격 안내" />
      </div>

      <!-- 15 (기존 15) 프로그램 선택 -->
      <div class="field field-large">
        <div class="field-label">
          15. 원하시는 다이어트 프로그램을 선택해주세요.
          (중복체크 가능) <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          현재 런칭 기념 기간한정(~ 26년 1월 31일)으로 이벤트 할인 중입니다.<br />
          요요관리도 같은 바디올핏입니다. 장해독환은 변비 시 사용하거나
          디톡스용으로 사용하실 수 있습니다.
        </div>
        <div class="options">
          <strong>★ 다이어트 프로그램</strong>
          <label>
            <input
              type="checkbox"
              name="program"
              value="4주(2+1)"
            />4주 프로그램 (바디올핏 3통 2+1) – 기간한정가 9.8만원 (32%↓)
          </label>
          <label>
            <input
              type="checkbox"
              name="program"
              value="8주(4+2)"
            />8주 프로그램 (바디올핏 6통 4+2) – 기간한정가 18.7만원 (35%↓)
          </label>
          <label>
            <input
              type="checkbox"
              name="program"
              value="12주(8+3)"
            />12주 프로그램 (바디올핏 11통 8+3) – 기간한정가 31.7만원 (40%↓)
          </label>

          <strong>☆ 요요방지 프로그램 (6개월)</strong>
          <label>
            <input
              type="checkbox"
              name="program"
              value="요요2x(16+4)"
            />Double(2x) 요요방지 – 바디올핏 20통(16+4) / 54.7만원 (43%↓)
          </label>
          <label>
            <input
              type="checkbox"
              name="program"
              value="요요3x(24+5)"
            />Triplet(3x) 요요방지 – 바디올핏 29통(24+5) / 75.2만원 (46%↓)
          </label>

          <strong>보조: 장해독환</strong>
          <label>
            <input
              type="checkbox"
              name="program"
              value="장해독1달(1통)"
            />장해독환 1달 1통 (프로그램 추가 시 10,000원 할인 → 1만원)
          </label>
          <label>
            <input
              type="checkbox"
              name="program"
              value="장해독3달(3통)"
            />장해독환 3달 3통 (프로그램 추가 시 30,000원 할인 → 2만원)
          </label>
        </div>

        <!-- 필독 안내 (빨간박스 + 검은글씨) -->
        <div class="highlight-box" style="border-left-color:#d93025;background:#fde7e7;">
          <strong>[처방 구매시 필독사항!!]</strong><br /><br />

          비대면의 경우,<br />
          [체험 프로그램, 장해독환]은 단독처방이 불가능합니다. (대면만 가능)<br /><br />

          다이어트 프로그램 중에서,<br />
          [4주, 8주 프로그램]은 4,000원의 '택배비'가 발생하며,<br />
          <strong>[12주 프로그램, 요요방지프로그램]은 '택배비'가 발생하지 않습니다.</strong>
        </div>

      </div>

      <!-- 16 (기존 16) 상담 희망시간 -->
      <div class="field field-large">
        <div class="field-label">
          16. 전화상담 희망시간을 체크해주세요. (중복체크 가능)
          <span class="required-mark">*</span>
        </div>
        <div class="options">
          <label>
            <input
              type="checkbox"
              name="consult_time"
              value="주중 오전"
            />주중 오전 10시~12시 반
          </label>
          <label>
            <input
              type="checkbox"
              name="consult_time"
              value="주중 오후"
            />주중 오후 2시~5시
          </label>
          <label>
            <input
              type="checkbox"
              name="consult_time"
              value="주중 저녁"
            />주중 오후 5시~8시
          </label>
          <label>
            <input
              type="checkbox"
              name="consult_time"
              value="주말 오전"
            />토·일·공휴일 오전 10시~12시 반
          </label>
          <label>
            <input
              type="checkbox"
              name="consult_time"
              value="주말 오후"
            />토·일·공휴일 오후 2시~3시 반
          </label>
        </div>
      </div>

      <!-- 17 (기존 17) 상담방법 -->
      <div class="field field-large">
        <div class="field-label">
          17. [비대면시 필수] 상담 방법을 선택해주세요.
        </div>
        <div class="options">
          <label>
            <input
              type="radio"
              name="consult_type"
              value="일반 전화통화"
              checked
            />일반 전화통화
          </label>
          <label>
            <input
              type="radio"
              name="consult_type"
              value="영상통화"
            />영상통화
          </label>
        </div>
      </div>

      <!-- 18 (기존 18) 계좌이체 / 현금영수증 -->
      <div class="field field-large">
        <div class="field-label">
          18. [비대면시 필수] 계좌이체하실 입금자명과 현금영수증 정보를 적어주세요.
        </div>
        <div class="field-desc">
          현재는 시스템 사정상 <strong>계좌이체만 결제가 가능</strong>합니다.
          카드/간편결제(PG)는 추후 별도 안내 예정입니다.<br /><br />
          먼저 입금자명을 적어주시고, 그 아래에서 <strong>전화번호 또는 사업자번호</strong>를 선택한 뒤 번호를 적어주세요.<br />
          (비어있는 경우, 위 주민번호로 현금영수증이 발행됩니다)<br />
          입금계좌 : 이동해 — 신한은행 110-522-009056
        </div>

        <!-- 이름 공란 -->
        <input
          type="text"
          id="depositor_name"
          name="depositor_name"
          placeholder="예시) 홍길동"
        />

        <!-- 전화번호 / 사업자번호 선택 + 숫자 입력 -->
        <div style="margin-top:8px;" class="inline-row">
          <div class="inline-field">
            <select id="receipt_type" name="receipt_type">
              <option value="">현금영수증 종류 선택</option>
              <option value="전화번호">전화번호</option>
              <option value="사업자번호">사업자번호</option>
            </select>
          </div>
          <div class="inline-field">
            <input
              type="text"
              id="receipt_value"
              name="receipt_value"
              inputmode="numeric"
              placeholder="예시) 01042847283"
            />
          </div>
        </div>
      </div>

      <!-- (삭제됨: 19번 카드결제 정보 블록 전체) -->

      <!-- 19 (기존 20) 개인정보 동의 -->
      <div class="field field-large">
        <div class="field-label">
          19. 다이어트 진료 목적을 위하여 개인정보 제공 및
          작성해주신 휴대폰 번호로 카카오톡 전송하는 것에
          동의하십니까? (대면·비대면 모두 필수)
          <span class="required-mark">*</span>
        </div>
        <div class="field-desc">
          수집 항목: 성명, 생년월일/주민등록번호, 연락처, 주소, 진료 관련 정보<br />
          이용 목적: 비대면·대면 진료 및 상담, 처방·결제, 택배 발송, 연말정산
          소득공제 처리<br />
          보유 기간: 의료법 및 세법 등 관련 법령에서 정한 기간 동안 보관 후
          파기<br />
          동의를 거부하실 수 있으나, 이 경우 비대면 다이어트 진료 진행이
          어려울 수 있습니다.
        </div>
        <label class="options-inline">
          <input
            type="checkbox"
            id="consent"
            name="consent"
            required
          />동의합니다.
        </label>
      </div>

      <div class="highlight-box">
        ★★★ 비대면 안내 ★★★<br />
        맨 아래 <strong>‘요약 생성하기’</strong> 버튼을 눌러 나온 내용을<br />
        전체 선택해서 복사하거나,
        <strong>‘텍스트 복사하기’ 버튼</strong>을 눌러 자동 복사한 뒤<br />
        <a href="https://pf.kakao.com/_wdtXK/chat" target="_blank">
          바디올한의원 카카오 채널
        </a>
        로 보내주시면 상담 예약이 완료됩니다.
      </div>

      <div class="button-row">
        <button type="button" class="primary-btn" onclick="makeSummary()">
          요약 생성하기
        </button>
        <button type="reset" class="secondary-btn">
          전체 초기화
        </button>
      </div>
    </form>

    <!-- 요약 출력 카드 -->
    <div class="card">
      <div class="section-title">카카오톡 전송용 문진 내용 요약</div>
      <p class="field-desc">
        아래 내용을 전체 선택(Ctrl+A 또는 길게 누르기 → 전체선택) 후 복사하거나,<br />
        바로 아래 <strong>‘텍스트 복사하기’ 버튼</strong>을 눌러 복사한 뒤<br />
        <a href="https://pf.kakao.com/_wdtXK/chat" target="_blank">
          바디올한의원 카카오 채널 (https://pf.kakao.com/_wdtXK/chat)
        </a>
        1:1 채팅으로 보내주세요.<br /><br />
        <strong>※ 붉은색 * 표시가 있는 필수 문항이 하나라도 비어 있으면 요약·전송이 되지 않습니다.</strong>
      </p>
      <textarea
        id="summaryText"
        class="summary-textarea"
        readonly
        placeholder="먼저 위 설문을 모두 작성하신 뒤 ‘요약 생성하기’를 눌러주세요.

※ 붉은색 *표시가 있는 필수 문항이 하나라도 비어 있으면 요약이 생성되지 않습니다.
   빠진 항목이 없는지 먼저 확인해 주세요."
      ></textarea>

      <div class="button-row">
        <button type="button" class="primary-btn" onclick="copySummary()">
          텍스트 복사하기
        </button>
      </div>
    </div>
  </div>
<script>
  // ★ 새 웹앱 URL (그대로 사용)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby-Zg2W8Fa5wab-W8lbR4SMSaxqjgrfKFyk1D4O-LWWXaAh_FAYkdTLaczuNmdcFiiT/exec";

  document.addEventListener("DOMContentLoaded", function () {
    setupRrnBackMasking();
  });

  // 체크박스 복수값 가져오기
  function getCheckedValues(name) {
    const nodes = document.querySelectorAll('input[name="' + name + '"]:checked');
    return Array.from(nodes).map(function (n) { return n.value; });
  }

  // 주민번호 뒷자리 마스킹 + 실제 값 hidden 저장
  function setupRrnBackMasking() {
    const displayInput = document.getElementById("rrn2_display");
    const hiddenInput  = document.getElementById("rrn2");

    if (!displayInput || !hiddenInput) return;

    displayInput.addEventListener("input", function () {
      let raw = displayInput.value.replace(/\D/g, "");
      if (raw.length > 7) raw = raw.slice(0, 7);
      hiddenInput.value = raw;

      if (raw.length === 0) {
        displayInput.value = "";
      } else {
        const first = raw[0];
        const masked = first + "*".repeat(raw.length - 1);
        displayInput.value = masked;
      }
    });

    displayInput.addEventListener("blur", function () {
      if (hiddenInput.value && hiddenInput.value.length !== 7) {
        alert("주민등록번호 뒷자리는 7자리 숫자로 입력해주세요.");
        displayInput.focus();
      }
    });
  }

  // 주민번호 전체 유효성 검사
  function validateRRN(front, back) {
    const rrn = (front || "").replace(/\D/g, "") + (back || "").replace(/\D/g, "");
    if (rrn.length !== 13) return false;
    if (!/^\d{13}$/.test(rrn)) return false;

    const yy = parseInt(rrn.slice(0, 2), 10);
    const mm = parseInt(rrn.slice(2, 4), 10);
    const dd = parseInt(rrn.slice(4, 6), 10);
    if (mm < 1 || mm > 12) return false;
    if (dd < 1 || dd > 31) return false;

    const digits = rrn.split("").map(Number);
    const weights = [2,3,4,5,6,7,8,9,2,3,4,5];
    let sum = 0;
    for (let i = 0; i < 12; i++) {
      sum += digits[i] * weights[i];
    }
    const mod = (11 - (sum % 11)) % 10;
    return mod === digits[12];
  }

  // 장해독 단독 선택 방지 + 유효성 검사
  function validateProgramSelection(programArr) {
    if (!programArr.length) {
      alert("희망 프로그램을 최소 1개 이상 선택해주세요.");
      return false;
    }

    const mainPrograms = programArr.filter(v =>
      v.startsWith("4주(") ||
      v.startsWith("8주(") ||
      v.startsWith("12주(") ||
      v.startsWith("요요2x") ||
      v.startsWith("요요3x")
    );

    const detoxPrograms = programArr.filter(v =>
      v.startsWith("장해독1달") || v.startsWith("장해독3달")
    );

    if (detoxPrograms.length > 0 && mainPrograms.length === 0) {
      alert("장해독환은 4·8·12주 또는 요요방지 프로그램과 함께만 처방 가능합니다.\n다이어트 프로그램을 먼저 선택해주세요.");
      return false;
    }
    return true;
  }

  // 프로그램 선택 → 총 결제금액 계산
  function calculateTotalAmount(programArr) {
    let total = 0;

    programArr.forEach(function (v) {
      if (v.startsWith("4주("))        total += 98000;
      else if (v.startsWith("8주("))   total += 187000;
      else if (v.startsWith("12주("))  total += 317000;
      else if (v.startsWith("요요2x")) total += 547000;
      else if (v.startsWith("요요3x")) total += 752000;
      else if (v.startsWith("장해독1달")) total += 10000;
      else if (v.startsWith("장해독3달")) total += 20000;
    });

    const has4or8 = programArr.some(v =>
      v.startsWith("4주(") || v.startsWith("8주(")
    );
    const hasFreeShip = programArr.some(v =>
      v.startsWith("12주(") ||
      v.startsWith("요요2x") ||
      v.startsWith("요요3x")
    );

    if (has4or8 && !hasFreeShip) {
      total += 4000;
    }

    return total;
  }

  // Apps Script로 전송 (CORS 우회: FormData + no-cors)
  function sendToSheet(payload) {
    const formData = new FormData();

    Object.keys(payload).forEach(function (key) {
      const value = payload[key];

      if (Array.isArray(value)) {
        value.forEach(function (v) {
          formData.append(key, v);
        });
      } else {
        formData.append(key, value);
      }
    });

    fetch(SCRIPT_URL, {
      method: "POST",
      body: formData,
      mode: "no-cors"
    }).catch(function (err) {
      console.error("시트 전송 중 오류 (전송 시도는 됨):", err);
    });
  }

  function makeSummary() {
    const form = document.getElementById("dietForm");
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    // --- 기본 정보 ---
    const visit = (document.querySelector('input[name="visit_experience"]:checked') || {}).value || "미응답";
    const name = document.getElementById("name").value.trim();
    const gender = document.getElementById("gender").value || "미응답";
    const age = document.getElementById("age").value.trim();
    const height = document.getElementById("height").value.trim();
    const weight = document.getElementById("weight").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const rrn1 = document.getElementById("rrn1").value.trim();
    const rrn2 = document.getElementById("rrn2").value.trim(); // hidden 실제 값

    // 주민번호 유효성 검사
    if (!validateRRN(rrn1, rrn2)) {
      alert("주민등록번호가 유효하지 않습니다. 다시 확인해주세요.");
      document.getElementById("rrn1").focus();
      return;
    }

    // referrer 문항은 UI에서 삭제 → 시트용은 공란으로 보냄
    const referrer = "";

    const diseases = document.getElementById("diseases").value.trim();
    const meds = document.getElementById("medications").value.trim();

    // --- 임신/다이어트 경험/몸상태 ---
    const pregArr = getCheckedValues("pregnancy");
    const pregOther = document.getElementById("pregnancy_other").value.trim();
    if (pregOther) pregArr.push("그 외: " + pregOther);

    const dietArr = getCheckedValues("diet_exp");
    const dietOther = document.getElementById("diet_exp_other").value.trim();

    const bodyArrBase = getCheckedValues("body_status");
    const bodyOther = document.getElementById("body_status_other").value.trim();
    const bodyArr = bodyArrBase.slice();
    if (bodyOther) bodyArr.push("기타: " + bodyOther);

    // --- 가장 걱정되는 점 ---
    const mainConcern = document.getElementById("main_concern").value.trim();

    // --- 배송 정보 ---
    const shipName = document.getElementById("ship_name").value.trim();
    const shipPhone = document.getElementById("ship_phone").value.trim();
    const shipAddress = document.getElementById("ship_address").value.trim();

    // --- 프로그램 / 상담시간 ---
    const programArr = getCheckedValues("program");
    if (!validateProgramSelection(programArr)) {
      return;
    }
    const consultTimeArr = getCheckedValues("consult_time");
    const consultType =
      (document.querySelector('input[name="consult_type"]:checked') || {}).value ||
      "일반 전화통화";

    // --- 결제 정보 (계좌) ---
    const depositorName = document.getElementById("depositor_name").value.trim() || "기입 없음";
    const receiptType = document.getElementById("receipt_type").value;
    const receiptValue = document.getElementById("receipt_value").value.trim();
    let receiptText = "기입 없음";
    if (receiptType && receiptValue) {
      receiptText = receiptType + ": " + receiptValue;
    } else if (receiptType || receiptValue) {
      receiptText = (receiptType || "종류 미선택") + " / 번호: " + (receiptValue || "미기입");
    }

    const consentChecked = document.getElementById("consent").checked;
    const consentText = consentChecked ? "동의함" : "미동의";

    // --- 총 결제금액 계산 ---
    const totalAmount = calculateTotalAmount(programArr);

    // --- 카드 정보는 더 이상 받지 않으므로 공란으로 처리 (시트 열 유지용) ---
    const cardCompany = "";
    const cardNumberCombined = "";
    const cardExpiry = "";
    const cardInstallment = "";

    // --- 요약 텍스트 생성 (가장 걱정되는 점을 최상단) ---
    let summary = "";
    summary += "【바디올핏 DIET 비대면 설문 요약】\n\n";

    if (mainConcern) {
      summary += "1) 가장 걱정되는 점:\n";
      summary += mainConcern + "\n\n";
    }

    summary += "2) 내원 경험: " + visit + "\n";
    summary += "3) 성함: " + name + "\n";
    summary += "4) 성별 / 나이: " + gender + " / " + age + "세\n";
    summary += "5) 키 / 몸무게: " + height + "cm / " + weight + "kg\n";
    summary += "6) 연락처: " + phone + "\n\n";

    summary += "7) 현재 앓고 있는 질환:\n";
    summary += (diseases ? diseases : "기입 없음") + "\n\n";

    summary += "8) 현재 복용 중인 약 / 건강보조식품:\n";
    summary += (meds ? meds : "기입 없음") + "\n\n";

    summary += "9) 임신·출산·수유 관련 사항:\n";
    if (pregArr.length) {
      summary += pregArr.join("\n") + "\n\n";
    } else {
      summary += "체크 없음\n\n";
    }

    summary += "10) 다이어트 한약/양약 복용 경험:\n";
    if (dietArr.length) {
      summary += dietArr.join("\n") + "\n";
    }
    if (dietOther) {
      summary += "상세: " + dietOther + "\n";
    }
    if (!dietArr.length && !dietOther) {
      summary += "체크 없음\n";
    }
    summary += "\n";

    summary += "11) 현재 몸상태:\n";
    if (bodyArr.length) {
      summary += bodyArr.join("\n") + "\n\n";
    } else {
      summary += "체크 없음\n\n";
    }

    summary += "12) 배송 정보:\n";
    summary += "수령인: " + shipName + "\n";
    summary += "연락처: " + shipPhone + "\n";
    summary += "주소: " + shipAddress + "\n\n";

    summary += "13) 선택한 프로그램:\n";
    if (programArr.length) {
      summary += programArr.join("\n") + "\n\n";
    } else {
      summary += "체크 없음\n\n";
    }

    summary += "14) 상담 희망시간: " + (consultTimeArr.length ? consultTimeArr.join(", ") : "체크 없음") + "\n";
    summary += "15) 상담 방법: " + consultType + "\n\n";

    summary += "16) 계좌이체 및 현금영수증 정보:\n";
    summary += "입금자명: " + depositorName + "\n";
    summary += "현금영수증: " + receiptText + "\n\n";

    summary += "17) 개인정보 제공 및 카카오톡 전송 동의: " + consentText + "\n\n";
    summary += "18) 총 결제 예상금액: " +
      (totalAmount ? totalAmount.toLocaleString("ko-KR") + "원" : "미산정") + "\n";

    const textarea = document.getElementById("summaryText");
    textarea.value = summary;
    textarea.scrollIntoView({ behavior: "smooth" });

    // --- 시트로 전송할 Payload 구성 (App Script doPost와 맞춤) ---
    const payload = {
      consent: consentText,
      visit_experience: visit,
      name: name,
      rrn1: rrn1,
      rrn2: rrn2,
      phone: phone,
      gender: gender,
      age: age,
      height: height,
      weight: weight,
      referrer: referrer, // 문항은 삭제됐지만 키는 유지 (공란)
      ship_name: shipName,
      ship_phone: shipPhone,
      ship_address: shipAddress,
      program: programArr,
      total_amount: totalAmount,
      consult_time: consultTimeArr,
      consult_type: consultType,
      depositor_name: depositorName,
      receipt_type: receiptType,
      receipt_value: receiptValue,
      card_company: cardCompany,
      card_number: cardNumberCombined,
      card_expiry: cardExpiry,
      card_installment: cardInstallment,
      main_concern: mainConcern // 신규 항목 (시트/스크립트에서 필요 시 활용)
    };

    sendToSheet(payload);
  }

  function copySummary() {
    const textarea = document.getElementById("summaryText");
    const text = textarea.value;
    if (!text) {
      alert("먼저 위 설문을 작성하신 뒤 ‘요약 생성하기’를 눌러 주세요.");
      return;
    }

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function () {
        alert("요약 내용을 복사했습니다. 카카오톡 채널에 붙여넣기 해주세요.");
      }).catch(function () {
        fallbackCopy(textarea);
      });
    } else {
      fallbackCopy(textarea);
    }
  }

  function fallbackCopy(textarea) {
    textarea.focus();
    textarea.select();
    try {
      document.execCommand("copy");
      alert("요약 내용을 복사했습니다. 카카오톡 채널에 붙여넣기 해주세요.");
    } catch (e) {
      alert("복사에 실패했습니다. 직접 전체 선택 후 복사해 주세요.");
    }
  }
</script>
</body>
</html>
