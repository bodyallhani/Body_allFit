<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>바디올핏 결제정보 입력</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans KR", sans-serif;
      background: #f1f3f4;
      color: #202124;
    }
    .card {
      max-width: 520px;
      margin: 0 auto;
      background: #fff;
      padding: 20px 18px 24px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.3);
    }
    h1 {
      font-size: 1.2rem;
      margin: 0 0 4px;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #5f6368;
      margin-bottom: 16px;
      line-height: 1.5;
    }
    .field {
      margin: 14px 0 20px;
    }
    .label {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .required {
      color: #d93025;
      margin-left: 3px;
    }
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #dadce0;
      font-size: 0.95rem;
    }
    input::placeholder,
    textarea::placeholder {
      font-size: 0.85rem;
      color: #80868b;
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 1px rgba(26,115,232,0.2);
    }
    .inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 0.85rem;
      margin-top: 4px;
    }
    .inline-options label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .section-title {
      font-size: 0.95rem;
      font-weight: 700;
      margin: 18px 0 6px;
      padding-top: 6px;
      border-top: 1px solid #e0e0e0;
    }
    .small-hint {
      font-size: 0.78rem;
      color: #80868b;
      margin-top: 2px;
      line-height: 1.4;
    }
    .consent-box {
      font-size: 0.8rem;
      background: #eef3ff;
      padding: 8px;
      border-radius: 6px;
      margin-top: 6px;
      line-height: 1.5;
    }
    button {
      width: 100%;
      margin-top: 16px;
      padding: 10px 0;
      border-radius: 6px;
      border: none;
      background: #1a73e8;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .hint {
      font-size: 0.8rem;
      color: #5f6368;
      margin-top: 10px;
      text-align: left;
      line-height: 1.5;
    }
    .bottom-space {
      height: 110px;
    }
    .hidden {
      display: none;
    }
    .rrn-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .rrn-row input {
      width: 100%;
    }
    .rrn-dash {
      font-size: 1.1rem;
      padding-top: 2px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>바디올핏 결제정보 입력</h1>
    <div class="subtitle">
      현재까지의 상담내용을 토대로,<br />
      결제 및 택배 발송에 필요한 정보를 입력해주시면 됩니다.
    </div>

    <form id="form3">
      <!-- 1. 기본 정보 -->
      <div class="section-title">1. 기본 정보</div>

      <div class="field">
        <div class="label">성함 <span class="required">*</span></div>
        <input
          type="text"
          id="name"
          name="name"
          required
          placeholder="실명 필수* 예: 장원영"
        />
      </div>

      <div class="field">
        <div class="label">연락처 <span class="required">*</span></div>
        <input
          type="tel"
          id="phone"
          name="phone"
          inputmode="numeric"
          pattern="\d*"
          required
          placeholder="예: 01012345678 (하이픈 없이)"
        />
      </div>

      <div class="field">
        <div class="label">주민등록번호 <span class="required">*</span></div>
        <div class="rrn-row">
          <input
            type="tel"
            id="rrn1_view"
            inputmode="numeric"
            pattern="\d*"
            maxlength="6"
            placeholder="앞 6자리 (예: 960101)"
          />
          <span class="rrn-dash">-</span>
          <input
            type="tel"
            id="rrn2_view"
            inputmode="numeric"
            pattern="\d*"
            maxlength="7"
            placeholder="뒤 7자리"
          />
        </div>
        <div class="small-hint">
          숫자만 입력해주세요. 하이픈(-)은 자동으로 처리됩니다.
        </div>
        <!-- 실제 전송용 hidden 필드 (doPost용) -->
        <input type="hidden" id="rrn1" name="rrn1" />
        <input type="hidden" id="rrn2" name="rrn2" />
      </div>

      <!-- 2. 택배 수령 정보 -->
      <div class="section-title">2. 택배 수령 정보</div>

      <div class="field">
        <div class="label">수령인 이름 <span class="required">*</span></div>
        <input
          type="text"
          id="ship_name"
          name="ship_name"
          required
          placeholder="예: 장원영"
        />
      </div>

      <div class="field">
        <div class="label">수령인 연락처 <span class="required">*</span></div>
        <input
          type="tel"
          id="ship_phone"
          name="ship_phone"
          inputmode="numeric"
          pattern="\d*"
          required
          placeholder="예: 01012345678 (하이픈 없이)"
        />
      </div>

      <div class="field">
        <div class="label">택배 수령 주소 <span class="required">*</span></div>
        <textarea
          id="ship_address"
          name="ship_address"
          required
          placeholder="예: (우편번호) 수원시 XX구 XX로 00, 000동 000호"
        ></textarea>
      </div>

      <!-- 3. 결제 정보 -->
      <div class="section-title">3. 결제 정보</div>

      <!-- 프로그램 안내 이미지 (img3 복원) -->
      <div class="field">
        <img
          id="img3"
          src="img3"
          alt="바디올핏 프로그램 안내"
          style="width:100%; max-width:480px; border-radius:8px; display:block; margin:4px 0 8px;"
        />
        <div class="small-hint">
          * 실제 사용 중인 안내 이미지 URL이 있다면, src 속성만 교체해서 사용하시면 됩니다.
        </div>
      </div>

      <div class="field">
        <div class="label">선택하신 프로그램</div>
        <div class="inline-options">
          <label><input type="radio" name="program" value="2주 프로그램" /> 2주 프로그램</label>
          <label><input type="radio" name="program" value="4주 프로그램" /> 4주 프로그램</label>
          <label><input type="radio" name="program" value="8주 프로그램" /> 8주 프로그램</label>
          <label><input type="radio" name="program" value="12주 프로그램" /> 12주 프로그램</label>
          <label><input type="radio" name="program" value="직접 입력" /> 기타 (상담 내용에 따라)</label>
        </div>
        <div class="small-hint">
          실제 프로그램명과 기간은 상담 시 안내받으신 내용을 그대로 선택해주시면 됩니다.
        </div>
      </div>

      <div class="field">
        <div class="label">총 결제 금액 (원) <span class="required">*</span></div>
        <input
          type="number"
          id="total_amount"
          name="total_amount"
          inputmode="numeric"
          pattern="\d*"
          required
          placeholder="예: 480000"
        />
        <div class="small-hint">
          숫자만 입력해주세요. (예: 택배비 포함 총 결제금액)<br />
          * 실제 금액은 상담 시 안내받으신 최종 금액을 입력하시면 됩니다.
        </div>
      </div>

      <div class="field">
        <div class="label">결제 방식 <span class="required">*</span></div>
        <div class="inline-options">
          <label><input type="radio" name="payment_method" value="카드 결제" required /> 카드 결제</label>
          <label><input type="radio" name="payment_method" value="계좌이체" /> 계좌이체</label>
        </div>
        <div class="small-hint">
          계좌이체를 선택하시면, 아래에 입금자명 및 현금영수증 정보를 입력해주시면 됩니다.
        </div>
      </div>

      <!-- 계좌이체 선택 시 노출 영역 -->
      <div id="bankBlock" class="hidden">
        <div class="field">
          <div class="label">입금자명</div>
          <input
            type="text"
            id="depositor_name"
            name="depositor_name"
            placeholder="실제 송금자 이름을 적어주세요."
          />
        </div>

        <div class="field">
          <div class="label">현금영수증 정보</div>
          <div class="small-hint">
            국세청 기준에 따라 현금영수증이 발행됩니다.<br />
            (비워두시면, 알려주신 연락처로 현금영수증 발행됩니다)
          </div>
          <div class="field" style="margin-top:10px;">
            <div class="label" style="font-weight:500; font-size:0.85rem;">현금영수증 종류</div>
            <div class="inline-options">
              <label><input type="radio" name="receipt_type" value="휴대폰 번호" /> 휴대폰 번호</label>
              <label><input type="radio" name="receipt_type" value="사업자 번호" /> 사업자 번호</label>
              <label><input type="radio" name="receipt_type" value="미발급/기부처리" /> 미발급/기부처리</label>
            </div>
          </div>
          <div class="field" style="margin-top:10px;">
            <div class="label" style="font-weight:500; font-size:0.85rem;">번호 입력 (선택)</div>
            <input
              type="tel"
              id="receipt_value"
              name="receipt_value"
              inputmode="numeric"
              pattern="\d*"
              placeholder="예: 01012345678 또는 1234567890"
            />
          </div>
        </div>
      </div>

      <!-- 개인정보 동의 (최종 확인용) -->
      <div class="field">
        <div class="label">개인정보 수집·이용 동의</div>
        <div class="consent-box">
          수집 항목: 성명, 연락처, 주민등록번호, 주소, 결제 및 배송 정보<br />
          이용 목적: 바디올핏 처방 및 결제, 택배 발송, 세무 신고를 위한 현금영수증 발급 등<br />
          보유 기간: 관련 법령에서 정한 기간 동안 보관 후 파기<br />
          이미 이전 단계에서 동의하신 내용을 바탕으로 진행되며,<br />
          추가적인 활용은 위 목적에 한정됩니다.
        </div>
      </div>

      <!-- 단계 / 비대면 표시 -->
      <input type="hidden" name="formType" value="3차" />
      <input type="hidden" name="visit_mode" value="비대면" />
      <input type="hidden" name="consent" value="동의함" />

      <button type="submit" id="submitBtn3">완료하기</button>

      <div class="hint">
        ※ 현재 설문에서 입력하신 결제·배송 정보만<br />
        한 번 더 확인 후, 한의원 내부 결제 시스템으로 전달됩니다.<br />
        잘못 입력된 내용이 없는지 제출 전 다시 한 번 확인해주세요.
      </div>

      <div class="bottom-space"></div>
    </form>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzlKD52BulhyKf7fo_fZYGtNv2tYXcPCQcBTtYHKQObwoRMCaHPZt2NI8D1bPwqJRhTow/exec";
    const KAKAO_URL  = "https://pf.kakao.com/_wdtXK/chat";

    // 결제 방식 선택 시 계좌이체 블럭 노출/숨김
    document.querySelectorAll('input[name="payment_method"]').forEach(function(radio) {
      radio.addEventListener("change", function() {
        const bankBlock = document.getElementById("bankBlock");
        if (this.value === "계좌이체") {
          bankBlock.classList.remove("hidden");
        } else {
          bankBlock.classList.add("hidden");
        }
      });
    });

    // 주민번호 마스킹 및 유효성 관리
    let rrn2Real = "";

    function onlyDigits(value, maxLen) {
      const digits = (value || "").replace(/\D/g, "");
      return digits.slice(0, maxLen);
    }

    const rrn1View = document.getElementById("rrn1_view");
    const rrn2View = document.getElementById("rrn2_view");
    const rrn1Hidden = document.getElementById("rrn1");
    const rrn2Hidden = document.getElementById("rrn2");

    rrn1View.addEventListener("input", function() {
      this.value = onlyDigits(this.value, 6);
    });

    rrn2View.addEventListener("input", function() {
      const digits = onlyDigits(this.value, 7);
      rrn2Real = digits;
      this.value = digits;
    });

    rrn2View.addEventListener("blur", function() {
      if (rrn2Real && rrn2Real.length === 7) {
        this.value = rrn2Real[0] + "******";
      }
    });

    rrn2View.addEventListener("focus", function() {
      if (this.value.indexOf("*") !== -1) {
        this.value = rrn2Real;
      }
    });

    document.getElementById("form3").addEventListener("submit", function(e) {
      e.preventDefault();

      const form = document.getElementById("form3");
      const btn  = document.getElementById("submitBtn3");

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const rrn1Val = onlyDigits(rrn1View.value, 6);
      const rrn2Val = rrn2Real ? rrn2Real : onlyDigits(rrn2View.value, 7);

      if (rrn1Val.length !== 6) {
        alert("주민등록번호 앞 6자리를 정확히 입력해주세요.");
        rrn1View.focus();
        return;
      }
      if (rrn2Val.length !== 7) {
        alert("주민등록번호 뒤 7자리를 정확히 입력해주세요.");
        rrn2View.focus();
        return;
      }

      rrn1Hidden.value = rrn1Val;
      rrn2Hidden.value = rrn2Val;

      const paymentSelected = document.querySelector('input[name="payment_method"]:checked');
      if (!paymentSelected) {
        alert("결제 방식을 선택해주세요.");
        return;
      }

      btn.disabled = true;
      const originalText = btn.textContent;
      btn.textContent = "전송 중...";

      const formData = new FormData(form);

      fetch(SCRIPT_URL, {
        method: "POST",
        body: formData,
        mode: "no-cors"
      }).catch(function(err){
        console.error("결제정보 전송 오류(전송은 시도됨):", err);
      }).finally(function() {
        alert(
          "결제 및 배송 정보가 전달되었습니다.\n\n상담실에서 내용을 확인한 뒤,\n결제 및 발송 관련 안내를 드리겠습니다."
        );
        btn.disabled = false;
        btn.textContent = originalText;
        window.location.href = KAKAO_URL;
      });
    });
  </script>
</body>
</html>
