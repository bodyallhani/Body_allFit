<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>바디올핏 다이어트 문진표 (대면용)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/bodyallhani/gen-intake/main/bodyall.png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/bodyallhani/gen-intake/main/bodyall.png">
  <style>
    /* 프리미엄 클리닉 디자인 시스템 */
    :root {
      --bg: #f4f7f9;
      --card-bg: #ffffff;
      --primary: #1e293b; 
      --accent: #c29f5d;  
      --text-main: #202124;
      --text-sub: #5f6368;
      --border: #dadce0;
      --required: #d93025;
      --radius: 12px;
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    
    body {
      margin: 0;
      padding: 20px 16px 120px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.5;
    }

    .container { max-width: 540px; margin: 0 auto; }

    header { text-align: center; margin-bottom: 25px; }
    .logo { width: 50px; margin-bottom: 10px; }
    h1 { font-size: 1.3rem; font-weight: 800; color: var(--primary); margin: 0 0 6px; }
    .subtitle { font-size: 0.9rem; color: var(--text-sub); word-break: keep-all; }

    .section-card {
      background: var(--card-bg);
      padding: 24px 20px;
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.2);
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 18px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .field { margin-bottom: 22px; }
    .label { font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; }
    .required { color: var(--required); margin-left: 2px; }
    .small-hint { font-size: 0.8rem; color: var(--text-sub); margin-top: 4px; line-height: 1.4; }

    input[type="text"], input[type="tel"], input[type="number"], textarea, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.95rem;
      background: #fafafa;
    }
    input:focus, textarea:focus { outline: none; border-color: #1a73e8; background: #fff; }

    .inline-options { display: flex; flex-wrap: wrap; gap: 8px 16px; margin-top: 6px; }
    label { display: inline-flex; align-items: center; gap: 5px; font-size: 0.88rem; cursor: pointer; }
    input[type="radio"], input[type="checkbox"] { width: 17px; height: 17px; accent-color: var(--accent); }

    .image-wrapper { text-align: center; margin-bottom: 15px; border-radius: 8px; overflow: hidden; }
    .image-wrapper img { max-width: 100%; display: block; }

    .highlight-box {
      background: #fdf2f2;
      border-left: 4px solid var(--required);
      padding: 14px;
      border-radius: 6px;
      font-size: 0.82rem;
      color: #3c4043;
      margin: 12px 0;
    }

    .total-amount-box {
      margin-top: 15px;
      padding: 18px;
      background: var(--primary);
      border-radius: 10px;
      color: #fff;
      text-align: center;
    }
    .total-amount-box div { font-size: 0.85rem; opacity: 0.8; margin-bottom: 5px; }
    .total-amount-box span { color: var(--accent); font-size: 1.5rem; font-weight: 800; }

    #allInOneBtn {
      width: 100%;
      background: #1a73e8;
      color: #fff;
      border: none;
      padding: 18px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 25px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    #allInOneBtn:disabled { background: #ccc; }

    .hint { font-size: 0.82rem; color: #5f6368; margin-top: 12px; line-height: 1.5; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <img class="logo" src="https://raw.githubusercontent.com/bodyallhani/gen-intake/main/bodyall.png" alt="logo">
    <h1>바디올핏 다이어트 문진표 (대면용)</h1>
    <div class="subtitle">개인별 맞춤 처방을 위해 아래 내용을 꼼꼼히 작성해 주세요.</div>
  </header>

  <form id="faceForm">
    <div class="section-card">
      <div class="section-title">1. 기본 정보</div>
      <div class="image-wrapper"><img src="img1.jpg" alt="바디올핏 안내"></div>
      
      <div class="field">
        <div class="label">이름 <span class="required">*</span></div>
        <input type="text" id="name" name="name" required placeholder="'실명'으로 써주세요. 예: 장원영" />
      </div>

      <div class="field">
        <div class="label">생년월일 (앞 6자리) <span class="required">*</span></div>
        <input type="text" id="rrn1" name="rrn1" inputmode="numeric" pattern="\d{6}" maxlength="6" required placeholder="예: 950101" />
        <div class="small-hint">주민등록번호 앞 6자리(YYMMDD)를 숫자만 입력해주세요.</div>
      </div>

      <div class="field">
        <div class="label">성별 <span class="required">*</span></div>
        <div class="inline-options">
          <label><input type="radio" name="gender" value="남성" required /> 남성</label>
          <label><input type="radio" name="gender" value="여성" /> 여성</label>
          <label><input type="radio" name="gender" value="기타/무응답" /> 기타</label>
        </div>
      </div>

      <div class="field">
        <div class="label">키 / 현재 체중 <span class="required">*</span></div>
        <div style="display:flex; gap:8px;">
          <input type="number" id="height" name="height" required placeholder="키 (cm)" />
          <input type="number" id="weight" name="weight" required placeholder="체중 (kg)" />
        </div>
      </div>

      <div class="field">
        <div class="label">직업 (또는 주된 생활 패턴)</div>
        <input type="text" id="job" name="job" placeholder="예: 사무직, 전업주부, 학생 등" />
      </div>

      <div class="field">
        <div class="label">하루 활동량 (복수 선택 가능)</div>
        <div class="inline-options">
          <label><input type="checkbox" name="activity" value="대부분 앉아서 지냄" /> 앉아서 지냄</label>
          <label><input type="checkbox" name="activity" value="서있거나 많이 걷는 편" /> 많이 걷는 편</label>
          <label><input type="checkbox" name="activity" value="육체노동/강도 높은 활동 많음" /> 강도 높은 활동</label>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">2. 수면 & 음주</div>
      <div class="field">
        <div class="label">수면 상태</div>
        <div class="inline-options">
          <label><input type="checkbox" name="sleep" value="잠들기 어렵다" /> 잠들기 어려움</label>
          <label><input type="checkbox" name="sleep" value="자주 깬다" /> 자주 깸</label>
          <label><input type="checkbox" name="sleep" value="자고 일어나도 피곤하다" /> 기상 후 피곤</label>
          <label><input type="checkbox" name="sleep" value="큰 문제 없다" /> 문제 없음</label>
        </div>
      </div>
      <div class="field">
        <div class="label">음주 빈도</div>
        <select id="drink" name="drink">
          <option value="">선택하세요</option>
          <option value="거의 안 마신다">거의 안 마신다</option>
          <option value="주 1~3회">주 1~3회</option>
          <option value="주 4회 이상">주 4회 이상</option>
        </select>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">3. 질환 / 복용약</div>
      <div class="field">
        <div class="label">현재 진단받은 질환 (복수 선택 가능)</div>
        <div class="inline-options">
          <label><input type="checkbox" name="disease" value="고혈압" /> 고혈압</label>
          <label><input type="checkbox" name="disease" value="당뇨" /> 당뇨</label>
          <label><input type="checkbox" name="disease" value="심장질환" /> 심장질환</label>
          <label><input type="checkbox" name="disease" value="갑상선질환" /> 갑상선</label>
          <label><input type="checkbox" name="disease" value="간/신장질환" /> 간/신장</label>
          <label><input type="checkbox" name="disease" value="정신과 진료 중" /> 정신과</label>
          <label><input type="checkbox" name="disease" value="기타" /> 기타</label>
          <label><input type="checkbox" name="disease_none" value="해당 없음" /> 해당 없음</label>
        </div>
        <textarea id="disease_etc" name="disease_etc" placeholder="기타 질환이 있다면 적어주세요." style="margin-top:10px;"></textarea>
      </div>

      <div class="field">
        <div class="label">현재 복용 중인 약</div>
        <div class="inline-options">
          <label><input type="checkbox" name="med" value="혈압약" /> 혈압약</label>
          <label><input type="checkbox" name="med" value="당뇨약" /> 당뇨약</label>
          <label><input type="checkbox" name="med" value="갑상선약" /> 갑상선약</label>
          <label><input type="checkbox" name="med" value="정신과 약" /> 정신과 약</label>
          <label><input type="checkbox" name="med" value="기타" /> 기타</label>
          <label><input type="checkbox" name="med_none" value="복용약 없음" /> 복용약 없음</label>
        </div>
        <textarea id="med_etc" name="med_etc" style="margin-top:10px; height:120px;" placeholder="약 이름을 모르셔도 대략 어떤 약인지 적어주세요.
*처방 불가 약물: 암페타민류, 독세핀, 노르트립틸린, 클로니딘, 코데인, 테오필린, 신지로이드, 아스피린 정기복용 등"></textarea>
      </div>

      <div class="field" id="femaleBlock">
        <div class="label">임신·출산·수유 관련 (여성 해당)</div>
        <div class="inline-options">
          <label><input type="radio" name="preg" value="임신 준비 중" /> 임신 준비</label>
          <label><input type="radio" name="preg" value="임신 중" /> 임신 중</label>
          <label><input type="radio" name="preg" value="출산 5주 이내" /> 출산 5주 이내</label>
          <label><input type="radio" name="preg" value="수유 중/예정" /> 수유 중</label>
          <label><input type="radio" name="preg" value="해당 없음" /> 해당 없음</label>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">4. 다이어트 경험 & 목표</div>
      <div class="field">
        <div class="label">이전에 해보신 다이어트 (복수 선택)</div>
        <div class="inline-options">
          <label><input type="checkbox" name="diet_exp" value="운동 위주" /> 운동</label>
          <label><input type="checkbox" name="diet_exp" value="식단 위주" /> 식단</label>
          <label><input type="checkbox" name="diet_exp" value="다이어트 한약" /> 한약</label>
          <label><input type="checkbox" name="diet_exp" value="다이어트 양약" /> 양약</label>
          <label><input type="checkbox" name="diet_exp" value="기타 프로그램" /> 기타</label>
          <label><input type="checkbox" name="diet_exp" value="거의 해본 적 없음" /> 없음</label>
        </div>
      </div>
      <div class="field">
        <div class="label">요요 경험</div>
        <div class="inline-options">
          <label><input type="radio" name="yo_yo" value="요요 경험 있다" /> 있음</label>
          <label><input type="radio" name="yo_yo" value="요요 경험 거의 없다" /> 없음</label>
          <label><input type="radio" name="yo_yo" value="다이어트 경험 없음" /> 경험 없음</label>
        </div>
      </div>
      <div class="field">
        <div class="label">목표 감량 kg 수</div>
        <input type="number" id="goal_weight" name="goal_weight" placeholder="예: 8" />
      </div>
      <div class="field">
        <div class="label">가능한 예산 범위</div>
        <input type="text" id="budget_range" name="budget_range" placeholder="예: 최대 10만원, 20~30만원 등" />
      </div>
      <div class="field">
        <div class="label">지금 가장 걱정되는 부분</div>
        <textarea id="main_concern" name="main_concern" placeholder="예: 요요, 폭식, 체력 저하 등"></textarea>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">5. 택배 수령 정보</div>
      <div class="field">
        <div class="label">수령인 이름 <span class="required">*</span></div>
        <input type="text" id="ship_name" name="ship_name" required />
      </div>
      <div class="field">
        <div class="label">수령인 연락처 <span class="required">*</span></div>
        <input type="tel" id="ship_phone" name="ship_phone" required placeholder="숫자만 입력" />
      </div>
      <div class="field">
        <div class="label">택배 수령 주소 <span class="required">*</span></div>
        <textarea id="ship_address" name="ship_address" required placeholder="우편번호를 포함한 전체 주소"></textarea>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">6. 프로그램 선택 & 결제</div>
      <div class="image-wrapper"><img src="img3.jpg" alt="가격안내"></div>
      
      <div class="field" id="programOptions">
        <div class="label">희망 다이어트 프로그램 <span class="required">*</span></div>
        <div style="font-weight:700; color:var(--accent); font-size:0.82rem; margin:10px 0 5px;">★ 다이어트 프로그램</div>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="4주(2+1)" /> 4주 (2+1) - 98,000원</label>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="8주(4+2)" /> 8주 (4+2) - 187,000원</label>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="12주(8+3)" /> 12주 (8+3) - 317,000원</label>

        <div style="font-weight:700; color:var(--accent); font-size:0.82rem; margin:15px 0 5px;">☆ 요요방지 프로그램</div>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="요요2x(16+4)" /> Double(2x) 20통 - 547,000원</label>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="요요3x(24+5)" /> Triplet(3x) 29통 - 752,000원</label>

        <div style="font-weight:700; color:var(--accent); font-size:0.82rem; margin:15px 0 5px;">보조: 장해독환</div>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="장해독1달(1통)" /> 장해독환 1달 1통 - 10,000원</label>
        <label style="display:block; margin:8px 0;"><input type="checkbox" name="program" value="장해독3달(3통)" /> 장해독환 3달 3통 - 20,000원</label>
      </div>

      <div class="highlight-box">
        ※ 4·8주 프로그램은 택배비 4,000원 추가, 12주 이상은 무료배송입니다. (비대면 시 장해독환 단독 처방 불가)
      </div>

      <div class="total-amount-box">
        <div>최종 결제 예상금액</div>
        <span id="totalAmountText">0원</span>
      </div>
      <input type="hidden" id="total_amount" name="total_amount" value="0" />

      <div class="field" style="margin-top:25px;">
        <div class="label">결제 방식 <span class="required">*</span></div>
        <div class="inline-options">
          <label><input type="radio" name="payment_method" value="카드 결제" required /> 카드 결제</label>
          <label><input type="radio" name="payment_method" value="계좌이체" /> 계좌이체</label>
        </div>
      </div>

      <div id="bankBlock" class="hidden">
        <div class="field" style="background:#f8fafc; padding:15px; border-radius:8px; margin-top:10px;">
          <div class="label">입금자명</div>
          <input type="text" name="depositor_name" id="depositor_name" />
          <div class="label" style="margin-top:15px;">현금영수증</div>
          <div class="inline-options">
            <label><input type="radio" name="receipt_type" value="휴대폰" /> 개인</label>
            <label><input type="radio" name="receipt_type" value="사업자" /> 사업자</label>
          </div>
          <input type="tel" name="receipt_value" id="receipt_value" placeholder="번호 입력" style="margin-top:10px;" />
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">7. 개인정보 동의</div>
      <div style="font-size:0.8rem; color:#666; background:#f1f5f9; padding:12px; border-radius:6px; line-height:1.5;">
        수집 항목: 성명, 성별, 신체정보, 건강상태, 주소, 연락처 등 문진 내용 일체<br>
        이용 목적: 한약 진단·상담·처방 및 결제·택배 발송 업무<br>
        보유 기간: 관련 법령에 따른 보관 후 파기
      </div>
      <div style="margin-top:15px; text-align:center;">
        <label style="font-weight:800; font-size:1rem;"><input type="checkbox" id="consent2" /> 위 내용에 동의합니다.</label>
      </div>
      <input type="hidden" name="consent" value="동의함" />

      <div class="hint">
        버튼을 누르면 <strong>내용이 자동 복사</strong>되어 카카오톡으로 연결됩니다. 채팅창에 <strong>'붙여넣기'</strong>하여 전송해 주세요.
      </div>

      <button type="button" id="allInOneBtn">최종응답 및 전송하기</button>
    </div>
    
    <textarea id="summary" name="summary" class="hidden"></textarea>
  </form>
</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzlKD52BulhyKf7fo_fZYGtNv2tYXcPCQcBTtYHKQObwoRMCaHPZt2NI8D1bPwqJRhTow/exec";
  const KAKAO_URL  = "https://pf.kakao.com/_wdtXK/chat";

  function getCheckedValues(name) {
    return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(n => n.value);
  }

  // 기존 buildSummary 로직 100% 복구 및 필드 대조 완료
  function buildSummary() {
    const f = (id) => document.getElementById(id).value.trim();
    const radio = (name) => (document.querySelector(`input[name="${name}"]:checked`) || {value:""}).value;

    const lines = [
      "■ [바디올핏 대면 문진]",
      `성함/성별: ${f("name")} / ${radio("gender")}`,
      `스펙: ${f("height")}cm / ${f("weight")}kg`,
      `직업/활동: ${f("job")} / ${getCheckedValues("activity").join(", ")}`,
      "",
      "■ 건강상태",
      `수면: ${getCheckedValues("sleep").join(", ")}`,
      `음주: ${f("drink")}`,
      `질환: ${getCheckedValues("disease").join(", ")} / 기타: ${f("disease_etc")}`,
      `복용약: ${getCheckedValues("med").join(", ")} / 상세: ${f("med_etc")}`,
      `부인과: ${radio("preg")}`,
      "",
      "■ 다이어트 정보",
      `경험: ${getCheckedValues("diet_exp").join(", ")}`,
      `요요: ${radio("yo_yo")}`,
      `목표: ${f("goal_weight")}kg / 예산: ${f("budget_range")}`,
      `고민: ${f("main_concern")}`,
      "",
      "■ 결제 및 배송",
      `프로그램: ${getCheckedValues("program").join(", ")}`,
      `총금액: ${Number(f("total_amount")).toLocaleString()}원`,
      `결제방식: ${radio("payment_method")}`,
      `수령인: ${f("ship_name")} (${f("ship_phone")})`,
      `주소: ${f("ship_address")}`
    ];

    const text = lines.join("\n");
    document.getElementById("summary").value = text;
    return text;
  }

  function copyToClipboard(text) {
    const t = document.createElement("textarea");
    document.body.appendChild(t);
    t.value = text;
    t.select();
    document.execCommand("copy");
    document.body.removeChild(t);
  }

  // 가격 및 배송비 계산기 (원본 로직 유지)
  document.getElementById("programOptions").addEventListener("change", function() {
    const programArr = getCheckedValues("program");
    let total = 0;
    programArr.forEach(v => {
      if (v.startsWith("4주")) total += 98000;
      else if (v.startsWith("8주")) total += 187000;
      else if (v.startsWith("12주")) total += 317000;
      else if (v.startsWith("요요2x")) total += 547000;
      else if (v.startsWith("요요3x")) total += 752000;
      else if (v.startsWith("장해독1달")) total += 10000;
      else if (v.startsWith("장해독3달")) total += 20000;
    });

    const has4or8 = programArr.some(v => v.startsWith("4주") || v.startsWith("8주"));
    const hasFree = programArr.some(v => v.startsWith("12주") || v.startsWith("요요"));
    if (has4or8 && !hasFree) total += 4000;

    document.getElementById("totalAmountText").textContent = total.toLocaleString() + "원";
    document.getElementById("total_amount").value = total;
  });

  document.querySelectorAll('input[name="payment_method"]').forEach(r => {
    r.addEventListener("change", function() {
      document.getElementById("bankBlock").classList.toggle("hidden", this.value !== "계좌이체");
    });
  });

  // 최종 전송 및 복사
  document.getElementById("allInOneBtn").addEventListener("click", function() {
    const form = document.getElementById("faceForm");
    if (!form.checkValidity()) { form.reportValidity(); return; }
    if (!document.getElementById("consent2").checked) { alert("동의가 필요합니다."); return; }

    this.disabled = true;
    const summaryText = buildSummary();
    copyToClipboard(summaryText);

    // [핵심] 구글 시트가 인식하는 필드명을 모두 추가하여 전송
    const formData = new FormData(form);
    formData.append("summary_text", summaryText);
    formData.append("summary", summaryText);
    formData.append("kakao_summary", summaryText);

    fetch(SCRIPT_URL, { method: "POST", body: formData, mode: "no-cors" })
      .then(() => {
        alert("문진 내용이 복사되었습니다.\n확인 버튼을 누르면 카카오톡으로 이동합니다.");
        window.location.href = KAKAO_URL;
      })
      .catch(() => {
        alert("전송 중 오류가 발생했으나 복사는 완료되었습니다.\n카톡에 붙여넣어 주세요.");
        window.location.href = KAKAO_URL;
      });
  });
</script>

</body>
</html>
